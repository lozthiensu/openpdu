<!--
<legend>
	Mean-Socket
	<a class="pull-right" ui-sref="Mean socket help page" target="_blank">Help</a>
</legend>
-->
<div class="row" data-ng-controller="MeanSocketController">

	<div  style="background-color: #B9D3DD;border-top-left-radius: 1em;border-bottom-left-radius: 1em;" class="col-lg-2 col-lg-offset-2">

		<h4>Phòng</h4>
		
		<hr />
		<ul class="nav nav-pills nav-stacked" style="overflow: auto; height:330px;">
			<li data-ng-repeat="channel in channels"
			    data-ng-click="createNewChannel(channel)"
					data-ng-class="{active: channel === activeChannel}">
				<a href="">{{channel}}</a>
			</li>
		</ul>
		<use-mean-socket after-join="socketAfterJoin(channel, messages)"
								mean-socket-after-get="socketAfterGet(message)"
								mean-socket-after-get-all-channels="socketAfterGetChannels(channels)"
								join-to-channel="activeChannel"/>
		<br>
		  <div style="margin-bottom:20px;" data-ng-if="ifAdmin(message)">
				<form data-ng-submit="createNewChannel(newChannel)">
					<div class="input-group">
						<input type="text" class="form-control" data-ng-model="newChannel" placeholder="Tên phòng"/>
						<span class="input-group-btn">
							<button class="btn btn-info">Tạo</button>
						</span>
					</div>
				</form>
		  </div>
		  <div style="margin-bottom:20px;" data-ng-if="!ifAdmin(message)">
				<form data-ng-submit="createNewChannel(newChannel)">
					<div class="input-group">
						<input  ng-disabled="true" type="text" class="form-control" data-ng-model="newChannel" placeholder="Giới hạn"/>
						<span class="input-group-btn">
							<button ng-disabled="true" class="btn btn-info">Tạo</button>
						</span>
					</div>
				</form>
		  </div>
	</div>

	<div style="background-color:#FFFFFF;border-top-right-radius: 1em;border-bottom-right-radius: 1em;" class="col-lg-6">

		<h4>Tin nhắn:</h4>
		<hr />	
		<div id="chatBox"  schroll-bottom="messages" style="overflow-x: hidden; height:350px;">
			<div data-ng-repeat="message in messages | orderBy:'time'">

				<blockquote data-ng-show="!hasAuthorization(message)">
					<div class="before-you"></div>
					<p ng-bind-html="message.message | emoticonize">{{message.message}}</p>			
					<small class="pull-left">{{message.user.name}} lúc {{message.time | date:'medium'}}</small>					
				</blockquote>

				<blockquote-me data-ng-show="hasAuthorization(message)">
					<div class="before-me"></div>
					<p ng-bind-html="message.message | emoticonize">{{message.message}}</p>
					<small class="pull-right">{{message.user.name}} lúc {{message.time | date:'medium'}}</small>
				</blockquote-me>

			</div>
		</div>
		<form data-ng-submit="sendMessage(message)">
			<div class="input-group">
			    <span popover-placement="top" popover-template="calendar.html" popover-trigger="click" class="input-group-addon"><img src="http://localhost:3000/comments/assets/lib/angular-emoticons/images/icon.png" height="22" width="22"></img></span>
			<script id="calendar.html" type="text/ng-template">
			<div id="tip" style="overflow-x: hidden; height:210px;">	
				<img src="http://localhost:3000/comments/assets/lib/angular-emoticons/images/1.png" height="70" width="70" ng-click="$parent.message.title = ':tho1:'"></img>
				<img src="http://localhost:3000/comments/assets/lib/angular-emoticons/images/2.png" height="70" width="70" ng-click="$parent.message.title = ':tho2:'"></img>
				<img src="http://localhost:3000/comments/assets/lib/angular-emoticons/images/3.png" height="70" width="70" ng-click="$parent.message.title = ':tho3:'"></img>
				<img src="http://localhost:3000/comments/assets/lib/angular-emoticons/images/4.png" height="70" width="70" ng-click="$parent.message.title = ':tho4:'"></img>
				<img src="http://localhost:3000/comments/assets/lib/angular-emoticons/images/5.png" height="70" width="70" ng-click="$parent.message.title = ':tho5:'"></img>
				<img src="http://localhost:3000/comments/assets/lib/angular-emoticons/images/6.png" height="70" width="70" ng-click="$parent.message.title = ':tho6:'"></img>
				<img src="http://localhost:3000/comments/assets/lib/angular-emoticons/images/7.png" height="70" width="70" ng-click="$parent.message.title = ':tho7:'"></img>
				<img src="http://localhost:3000/comments/assets/lib/angular-emoticons/images/8.png" height="70" width="70" ng-click="$parent.message.title = ':tho8:'"></img>
				<img src="http://localhost:3000/comments/assets/lib/angular-emoticons/images/9.png" height="70" width="70" ng-click="$parent.message.title = ':tho9:'"></img>
				<img src="http://localhost:3000/comments/assets/lib/angular-emoticons/images/10.png" height="70" width="70" ng-click="$parent.message.title = ':tho10:'"></img>
				<img src="http://localhost:3000/comments/assets/lib/angular-emoticons/images/11.png" height="70" width="70" ng-click="$parent.message.title = ':tho11:'"></img>
				<img src="http://localhost:3000/comments/assets/lib/angular-emoticons/images/12.png" height="70" width="70" ng-click="$parent.message.title = ':tho12:'"></img>
				<img src="http://localhost:3000/comments/assets/lib/angular-emoticons/images/13.png" height="70" width="70" ng-click="$parent.message.title = ':tho13:'"></img>
				<img src="http://localhost:3000/comments/assets/lib/angular-emoticons/images/14.png" height="70" width="70" ng-click="$parent.message.title = ':tho14:'"></img>
				<img src="http://localhost:3000/comments/assets/lib/angular-emoticons/images/15.png" height="70" width="70" ng-click="$parent.message.title = ':tho15:'"></img>
				<img src="http://localhost:3000/comments/assets/lib/angular-emoticons/images/16.png" height="70" width="70" ng-click="$parent.message.title = ':tho16:'"></img>
				<img src="http://localhost:3000/comments/assets/lib/angular-emoticons/images/17.png" height="70" width="70" ng-click="$parent.message.title = ':tho17:'"></img>
				<img src="http://localhost:3000/comments/assets/lib/angular-emoticons/images/18.png" height="70" width="70" ng-click="$parent.message.title = ':tho18:'"></img>
				<img src="http://localhost:3000/comments/assets/lib/angular-emoticons/images/19.png" height="70" width="70" ng-click="$parent.message.title = ':tho19:'"></img>
				<img src="http://localhost:3000/comments/assets/lib/angular-emoticons/images/20.png" height="70" width="70" ng-click="$parent.message.title = ':tho20:'"></img>
				<img src="http://localhost:3000/comments/assets/lib/angular-emoticons/images/21.png" height="70" width="70" ng-click="$parent.message.title = ':tho21:'"></img>
				<img src="http://localhost:3000/comments/assets/lib/angular-emoticons/images/22.png" height="70" width="70" ng-click="$parent.message.title = ':tho22:'"></img>
				<img src="http://localhost:3000/comments/assets/lib/angular-emoticons/images/23.png" height="70" width="70" ng-click="$parent.message.title = ':tho23:'"></img>
				<img src="http://localhost:3000/comments/assets/lib/angular-emoticons/images/24.png" height="70" width="70" ng-click="$parent.message.title = ':tho24:'"></img>
				<img src="http://localhost:3000/comments/assets/lib/angular-emoticons/images/25.png" height="70" width="70" ng-click="$parent.message.title = ':tho25:'"></img>
				<img src="http://localhost:3000/comments/assets/lib/angular-emoticons/images/26.png" height="70" width="70" ng-click="$parent.message.title = ':tho26:'"></img>
				<img src="http://localhost:3000/comments/assets/lib/angular-emoticons/images/27.png" height="70" width="70" ng-click="$parent.message.title = ':tho27:'"></img>
				<img src="http://localhost:3000/comments/assets/lib/angular-emoticons/images/28.png" height="70" width="70" ng-click="$parent.message.title = ':tho28:'"></img>
				<img src="http://localhost:3000/comments/assets/lib/angular-emoticons/images/29.png" height="70" width="70" ng-click="$parent.message.title = ':tho29:'"></img>
				<img src="http://localhost:3000/comments/assets/lib/angular-emoticons/images/30.png" height="70" width="70" ng-click="$parent.message.title = ':tho30:'"></img>
			</div>
			</script>
				<input type="text" class="form-control" data-ng-model="$parent.message.title" placeholder="Nhập tin nhắn"/>
				<span class="input-group-btn"><div mean-socket
					message="{message:$parent.message.title, channel: activeChannel}"
					after-send="socketAfterSend(message)"></div>
				</span>
			</div>
		</form>
		<br>
	</div>
</div>
